<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1200px, user-scalable=no">
<title>無題ドキュメント</title>
<link type="text/css" rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/cupertino/jquery-ui.min.css" />
<link rel="stylesheet" type="text/css" href="./css/ctrl.css">
<script src="/socket.io/socket.io.js"></script> 
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
//$(window).bind("resize", function(){
//    $("html").css( "zoom" , $(window).width() / 1200 );
//  }).trigger("resize");
</script>
<script src="https://code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
<script src="./jquery_modules/jquery.ui.touch-punch.min.js"></script>
<script src="./js_core_plugin/jscolor/jscolor.js"></script>
<script type="text/javascript">

 var s = io.connect(); //リモート
  //var s = io.connect('http://localhost:3000'); //ローカル

  //サーバから受け取るイベント
  s.on("connect", function () {});  // 接続時
  s.on("disconnect", function (client) {});  // 切断時
  s.on("S_to_C_message", function (data) {
    addMessage(data.value);
  });
//ここから変数


//var msg=new Array[3];

  //クライアントからイベント送信（イベント名は自由に設定できます）
  function sendMessage(c_1,c_2,c_3,c_4) {
    var msg= new Array(3);
  msg[0] = c_1;
var txt = $("#text_input").val(); //取得
  msg[1] = txt;
  msg[3]=c_4;
//msg[2] = c_3;
  //msg="rgb("+c_1+","+c_2+","+c_3+")";
  //var msg= new Array(3);
  //msg[0] = c_1;
//msg[1] = c_2;
//msg[2] = c_3;
  //var msg = $("#message").val(); //取得
    //$("#message").val(""); //空白にする
    s.emit("C_to_S_message", {value:msg}); //サーバへ送信
  }
  
  function sendText() {
    var msg= new Array(3);
  var txt = $("#text_input").val(); //取得
  msg[1] = txt;
   s.emit("C_to_S_message", {value:msg}); //サーバへ送信
  }

   

  function sendBroadcast() {
    var msg = $("#message").val(); //取得
    $("#message").val(""); //空白にする
    s.emit("C_to_S_broadcast", {value:msg}); // サーバへ送信
  }

  //jqueryでメッセージを追加
  function addMessage (value,color,size) {
    var comp=value
    var msg = comp//.replace( /[!@$%<>'"&|]/g, '' ); //タグ記号とかいくつか削除
  //var t1=comp[1].replace( /[!@$%<>'"&|]/g, '' ); //タグ記号とかいくつか削除
    //ログの書き出し
  //$("#msg_list").prepend("<p class='msg'>text:" + t1+ "</p>");
  $("#msg_list").prepend("<p class='msg'>msg:" + msg+ "</p>");
  $("#sp_bg,#sc_bg").css({"backgroundColor":''+msg});
  //$("#scr_1").css({"opacity":msg[0]});
  //$("#scr_2").css({"opacity":msg[1]})
  //$("#scr_3").css({"opacity":msg[2]})
  }    




  </script>
<script type="text/javascript">
$(function() {
  // 2スライダーを適用
  $('#color_slider').slider({
    min: 0,
    max: 100,
    step: 2,
    value: 50,
    // 3スライダーの変化時にテキストボックスの値表示を更新
    change: function(e, ui) {
      $('#num').val(ui.value);
    },
    // 4スライダーの初期化時に、その値をテキストボックスにも反映
    create: function(e, ui) {
      $('#num').val($(this).slider('option', 'value'));
    }
  });
  //
$('#video_slider').slider({
    min: 0,
    max: 100,
    step: 1,
    value: 0,
    // 3スライダーの変化時にテキストボックスの値表示を更新
    slide: function(e, ui) {
      
      slideFader(ui.value);
    }
  });
//
$('#master_light_slider').slider({
  orientation: 'vertical',
    min: 0,
    max: 100,
    step: 2,
    value: 50,
    // 3スライダーの変化時にテキストボックスの値表示を更新
    change: function(e, ui) {
      $('#num').val(ui.value);
    },
    // 4スライダーの初期化時に、その値をテキストボックスにも反映
    create: function(e, ui) {
      $('#num').val($(this).slider('option', 'value'));
    }
  });
//
$('#master_screen_slider').slider({
  orientation: 'vertical',
    min: 0,
    max: 100,
    step: 2,
    value: 50,
    // 3スライダーの変化時にテキストボックスの値表示を更新
    change: function(e, ui) {
      $('#num').val(ui.value);
    },
    // 4スライダーの初期化時に、その値をテキストボックスにも反映
    create: function(e, ui) {
      $('#num').val($(this).slider('option', 'value'));
    }
  });
//
});

//以下外部に逃がす
tmp_nowCh=1;
//文字列rgb(r,g,b)から配列RGB[r,g,b]に
function cssToRgb(cssColor){
  RGB=cssColor.replace('rgb',"").replace('(',"").replace(')',"").replace(/ /g,"").split(',');
  return RGB;
}
//対象要素名と配列RGB[r,g,b]を渡すと、その要素の背景色をその色に変更
function changeBG(targetID,masterRGB){
 
  tmp_bgColor='rgb('+masterRGB[0]+','+masterRGB[1]+','+masterRGB[2]+')'
 console.log(masterRGB);
  console.log(targetID);
  console.log(tmp_bgColor);
  $(targetID).css({'backgroundColor':tmp_bgColor});
}
//2つのRGB値から指定割合でのRGBを検出
function calRGB(RgbAch,RgbBch,Bal){
var tmp_RGB=[0,0,0]
Bal=Bal/100;
tmp_RGB[0]=RgbAch[0]*(1-Bal)+RgbBch[0]*Bal;
tmp_RGB[1]=RgbAch[1]*(1-Bal)+RgbBch[1]*Bal;
tmp_RGB[2]=RgbAch[2]*(1-Bal)+RgbBch[2]*Bal;
tmp_RGB[0]=Math.round(tmp_RGB[0]);
tmp_RGB[1]=Math.round(tmp_RGB[1]);
tmp_RGB[2]=Math.round(tmp_RGB[2]);
return tmp_RGB;
}


//calRGB(test_a,test_b,bal)

//スイッチボタンを押した時の挙動
function switchBtn(){
  bgcolorB=$('#color_ch_b').css('background-color');
  bgcolorA=$('#color_ch_a').css('background-color');
  bgcolorA=cssToRgb(bgcolorA);
  bgcolorB=cssToRgb(bgcolorB);
  if(tmp_nowCh!=2){
    bal=100;
    tmp_nowCh=2;

  }else{
    bal=0;
    tmp_nowCh=1;}
    $('#video_slider>span').css({left:bal+'%'});
  tmp_RGB=calRGB(bgcolorA,bgcolorB,bal);
  changeBG('#ch_a',tmp_RGB);  
   sendMessage(tmp_RGB,0,0,0); 
}

//スライダー挙動
function slideFader(bal){
  bgcolorB=$('#color_ch_b').css('background-color');
  bgcolorA=$('#color_ch_a').css('background-color');
  bgcolorA=cssToRgb(bgcolorA);
  bgcolorB=cssToRgb(bgcolorB);
  tmp_RGB=calRGB(bgcolorA,bgcolorB,bal);
  console.log(tmp_RGB)
  changeBG('#ch_a',tmp_RGB);
  sendMessage(tmp_RGB,0,0,0); 
}

$(document).ready(function(){
//スイッチクリック  
$('.switch').click(function(){
  switchBtn();
})
//タップしたカラーパレットをアクティブに
$('.color').click(function(){
  $('.color').removeClass('active');
  $(this).addClass('active');
})
//SET-Aをタップ
$('#color_ch_a_set').click(function(){
  activePalletBg=$('.active').css('background-color');
  $('#color_ch_a').css('background-color',activePalletBg);
})
//SET-Bをタップ
$('#color_ch_b_set').click(function(){
  activePalletBg=$('.active').css('background-color');
  $('#color_ch_b').css('background-color',activePalletBg);
})
//Boutをタップ(未実装)
$('#led_bout').click(function(){
  activePalletBg=$('.active').css('background-color');
  $('#color_ch_b').css('background-color',activePalletBg);
})

})
</script>


</head>

<body id="ctrl">
<div id="wrap">
<div id="main">
<img id="logo" src="img/ui/logo.png">
<section id="master">
  <div id="monitor">
<div id="ch_a"></div>
<div id="ch_b"></div>
  </div>
  <div id="master_fader">

<div id="master_screen_slider" ></div>
<div id="master_center">
<h6 class="float_l">SCREEN<br>MASTER</h6>
<h6 class="float_r">LED<br>MASTER</h6>
<div class="btn_group float_l">
<input type="submit" class="btn_submit w_out" value="W OUT"></input>
<input type="submit" class="btn_submit b_out" value="B OUT"></input>
</diV>
<div class="btn_group float_r">
<input type="submit" class="btn_submit w_out" value="W OUT"></input>
<input type="submit" class="btn_submit b_out" value="B OUT"></input>
</diV>
</div>
<div id="master_light_slider" ></div>
  </div>
</section>
<section id="color_theme">
<div class="col_l">
<div class="pallet" ></div>
</div>

<div class="col_m">
<input type="submit" class="btn_submit switch" value="SWITCH A⇄B"></input>
<div id="color_slider" ></div>

</div>

<div class="col_r">
<div class="pallet" ></div>
</div>
<!--1スライダーを表示する領域-->
<h6>COLOR THEME</h6>
</section>
<section id="video">
	<h6>COLOR THEME</h6>
<div class="col_l">
<div class="pallet" id="color_ch_a"></div>
<input type="submit" class="btn_submit set" value="▲" id="color_ch_a_set"></input>
</div>

<div class="col_m">
<input type="submit" class="btn_submit switch" value="SWITCH A⇄B"></input>
<div id="video_slider" ></div>

</div>

<div class="col_r">
<div class="pallet" id="color_ch_b"></div>
<input type="submit" class="btn_submit set" value="▲" id="color_ch_b_set"></input>
</div>
<!--1スライダーを表示する領域-->
<div class="sub_pallet">
  <div class="sub_pallet_wrap">
  <input class="color">
  <input class="color">
  <input class="color">
  <input class="color">
  <input class="color">
  <input class="color">
  <input class="color">
  
  </div>
</div>
</section>

<section id="text">
<h6>TEXT</h6>
<input type="text" name="text" class="text_form" id="text">

<input type="submit" class="btn_submit" value="SEND" id="text_send">
</section>


</div>
</div>
</body>
</html>
