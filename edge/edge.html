<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <link rel="shortcut icon" href="../img/favicon.ico" />
	<title>無題</title>
<!--Adobe Edge Runtime-->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <script type="text/javascript" charset="utf-8" src="edge_includes/edge.5.0.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <style>

        .edgeLoad-EDGE-28183762 { visibility:hidden; }
    </style>
<script>
   AdobeEdge.loadComposition('edge', 'EDGE-28183762', {
    scaleToFit: "width",
    centerStage: "none",
    minW: "0",
    maxW: "undefined",
    width: "800px",
    height: "450px"
}, {dom: [ ]}, {dom: [ ]});
</script>
<!--Adobe Edge Runtime End-->

<script type="text/javascript">
    var s = io.connect(); //リモート
    //var s = io.connect('http://localhost:3000'); //ローカル

    //サーバから受け取るイベント
    s.on("connect", function() {}); // 接続時
    s.on("disconnect", function(client) {}); // 切断時
    s.on("S_to_C_message", function(data) {
        addMessage(data.value);
    });
    //ここから変数


    //var msg=new Array[3];

    //操作画面から送信
    function sendMessage(c_1, c_2, c_3, c_4) {
        var msg = new Array(4);
        msg[0] = c_1;
        var txt = $("#text_input").val(); //取得
        msg[1] = txt;
        msg[3] = c_4;
        //msg[2] = c_3;
        //msg="rgb("+c_1+","+c_2+","+c_3+")";
        //var msg= new Array(3);
        //msg[0] = c_1;
        //msg[1] = c_2;
        //msg[2] = c_3;
        //var msg = $("#message").val(); //取得
        //$("#message").val(""); //空白にする
        s.emit("C_to_S_message", {
            value: msg
        }); //サーバへ送信
    }


    function sendText() {
        var msg = new Array(3);
        var txt = $("#text_form").val(); //取得
        console.log(txt);
        msg[1] = txt;

        s.emit("C_to_S_message", {
            value: msg
        }); //サーバへ送信
    }


 //操作画面から送信(対象に操作画面を含まない)
    function sendBroadcast() {
        var msg = $("#message").val(); //取得
        $("#message").val(""); //空白にする
        s.emit("C_to_S_broadcast", {
            value: msg
        }); // サーバへ送信
    }

    //他からイベントを受け取った時→クライアントからの接続要求に応じて現在の設定を送り返す
    function addMessage(value, color, size, connect) {
        var initial_flg = value[3];
        if (initial_flg == "connect") {
            sendMessage(masterRGB, 0, 0, 0);
        }
    }
    //
    masterRGB= new Array(4);
        //文字列rgb(r,g,b)から配列[r,g,b]に
        function cssToRgb(cssColor) {
                var tmp_RGB = masterRGB;
                tmp_RGB = cssColor.replace('rgb', "").replace('(', "").replace(')', "").replace(/ /g, "").split(',');
                return tmp_RGB;
            }
preRGB="";

//最終的なプッシュ
        function confirmRGB(setRGB) {
                //masterRGBに値をセット
                masterRGB = setRGB;
                sendMessage(masterRGB, 0, 0, 0);
                //changeBG('#ch_a', masterRGB);
            }
    function monitorGetter(){
        var tmp_RGB=$('#Stage_monitor').css('background-color');
        if (preRGB!=tmp_RGB){
            preRGB=tmp_RGB;
            var tmp_RGB=cssToRgb(tmp_RGB);
            masterRGB=[tmp_RGB[0],tmp_RGB[1],tmp_RGB[2],255]
            console.log(masterRGB);
            confirmRGB(masterRGB);
           
        };
    }
   
    </script>
</head>
<body style="margin:0;padding:0;">
	<div id="Stage" class="EDGE-28183762">
	</div>
</body>
</html>